<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//Pole.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.auggie.student_server.mapper.InitMapper">

    <!-- 一键清空测试数据（保留表结构） -->
    <update id="clearTestData">
        SET FOREIGN_KEY_CHECKS = 0;
        DELETE FROM studentms.score;
        DELETE FROM studentms.score_import_record;
        DELETE FROM studentms.operation_log;
        DELETE FROM studentms.student;
        DELETE FROM studentms.teacher WHERE role != 'admin';
        DELETE FROM studentms.class;
        DELETE FROM studentms.major;
        DELETE FROM studentms.grade_level;
        DELETE FROM studentms.department;
        DELETE FROM studentms.course;
        SET FOREIGN_KEY_CHECKS = 1;
    </update>

    <!-- 重新插入初始数据 -->
    <update id="insertInitialData">
        SET FOREIGN_KEY_CHECKS = 0;
        
        DELETE FROM studentms.score;
        DELETE FROM studentms.score_import_record;
        DELETE FROM studentms.operation_log;
        DELETE FROM studentms.exam_paper_analysis;
        DELETE FROM studentms.course_open;
        DELETE FROM studentms.student;
        DELETE FROM studentms.teacher;
        DELETE FROM studentms.class;
        DELETE FROM studentms.major;
        DELETE FROM studentms.grade_level;
        DELETE FROM studentms.department;
        DELETE FROM studentms.course;

        INSERT INTO studentms.department (id, name) VALUES
        (1, '经济管理学院'),
        (2, '医学技术学院'),
        (3, '康复治疗学院');

        INSERT INTO studentms.major (id, name, department_id) VALUES
        (1, '会计学', 1),
        (2, '医学检验技术', 2),
        (3, '康复治疗技术', 3);

        INSERT INTO studentms.class (id, name, major_id, department_id) VALUES
        (1, '1班', 1, 1),
        (2, '1班', 2, 2),
        (3, '1班', 3, 3);

        INSERT INTO studentms.grade_level (id, name, sort_order) VALUES
        (1, '2022级', 1),
        (2, '2023级', 2),
        (3, '2024级', 3),
        (4, '2025级', 4);

        INSERT INTO studentms.teacher (id, teacher_no, tname, password, role, department_id) VALUES
        (1, 'admin', '系统管理员', '123', 'admin', 1),
        (2, 'dean1', '经济管理学院院长', '123', 'dean', 1),
        (3, 'dean2', '医学技术学院院长', '123', 'dean', 2),
        (4, 'dean3', '康复治疗学院院长', '123', 'dean', 3),
        (5, 'T1001', '张老师', '123', 'teacher', 1),
        (6, 'T2001', '李老师', '123', 'teacher', 2),
        (7, 'T3001', '王老师', '123', 'teacher', 3);

        INSERT INTO studentms.student (id, student_no, sname, password, class_id, grade_level_id, major_id, department_id) VALUES
        (1, 'student', '学生本人', '123', 1, 3, 1, 1),
        (2, 'S24001', '赵小明', '123', 1, 3, 1, 1),
        (3, 'S24002', '钱小红', '123', 1, 3, 1, 1),
        (4, 'S24003', '孙小军', '123', 2, 3, 2, 2),
        (5, 'S24004', '周小丽', '123', 3, 3, 3, 3);

        INSERT INTO studentms.course (id, cname, ccredit, major_id, department_id, category, nature, exam_method, hours) VALUES
        (1, '基础会计', 3, 1, 1, '必修', '理论', '考试', 48),
        (2, '经济学基础', 3, 1, 1, '必修', '理论', '考试', 48),
        (3, '临床检验基础', 4, 2, 2, '必修', '理论', '考试', 64),
        (4, '康复评定技术', 4, 3, 3, '必修', '理论', '考试', 64);

        INSERT INTO studentms.course_open (course_id, teacher_id, term) VALUES
        (1, 5, '2024-2025-1'),
        (2, 5, '2024-2025-1'),
        (3, 6, '2024-2025-1'),
        (4, 7, '2024-2025-1');

        INSERT INTO studentms.score (
          student_id, course_id, teacher_id, term, 
          usual_score, mid_score, final_score, grade, status
        ) VALUES 
        (1, 1, 5, '2024-2025-1', 85.00, NULL, 90.00, 88, 'PUBLISHED'),
        (2, 1, 5, '2024-2025-1', 78.00, NULL, 82.00, 81, 'PUBLISHED'),
        (3, 1, 5, '2024-2025-1', 92.00, NULL, 88.00, 89, 'PUBLISHED'),
        (1, 2, 5, '2024-2025-1', 90.00, NULL, 85.00, 87, 'PUBLISHED'),
        (4, 3, 6, '2024-2025-1', 88.00, NULL, 86.00, 87, 'PUBLISHED'),
        (5, 4, 7, '2024-2025-1', 82.00, NULL, 90.00, 87, 'UPLOADED');
        
        SET FOREIGN_KEY_CHECKS = 1;
    </update>

</mapper>
