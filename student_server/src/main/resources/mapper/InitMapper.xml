<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//Pole.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.auggie.student_server.mapper.InitMapper">

    <!-- 一键清空测试数据（保留表结构） -->
    <update id="clearTestData">
        SET FOREIGN_KEY_CHECKS = 0;
        DELETE FROM studentms.score;
        DELETE FROM studentms.score_import_record;
        DELETE FROM studentms.operation_log;
        DELETE FROM studentms.student;
        DELETE FROM studentms.teacher WHERE role != 'admin';
        DELETE FROM studentms.class;
        DELETE FROM studentms.major;
        DELETE FROM studentms.department;
        DELETE FROM studentms.course;
        SET FOREIGN_KEY_CHECKS = 1;
    </update>

    <!-- 重新插入初始数据 -->
    <update id="insertInitialData">
        SET FOREIGN_KEY_CHECKS = 0;
        
        DELETE FROM studentms.score;
        DELETE FROM studentms.score_import_record;
        DELETE FROM studentms.operation_log;
        DELETE FROM studentms.exam_paper_analysis;
        DELETE FROM studentms.student;
        DELETE FROM studentms.teacher WHERE role != 'admin';
        DELETE FROM studentms.class;
        DELETE FROM studentms.major;
        DELETE FROM studentms.department;
        DELETE FROM studentms.course;
        DELETE FROM studentms.course_open;

        INSERT INTO studentms.department (id, name) VALUES
        (1, '计算机工程学院'), (2, '经济管理学院'), (3, '艺术设计学院');

        INSERT INTO studentms.major (id, name, department_id) VALUES
        (1, '信息安全技术应用', 1), (2, '软件技术', 1), (3, '大数据技术', 1),
        (4, '会计学', 2), (5, '市场营销', 2),
        (6, '视觉传达设计', 3);

        INSERT INTO studentms.class (id, name, major_id, department_id) VALUES
        (1, '1班', 1, 1), (2, '2班', 1, 1), (3, '3班', 1, 1),
        (4, '1班', 2, 1), (5, '1班', 4, 2);

        INSERT INTO studentms.course (id, cname, ccredit, major_id, department_id, category, nature, exam_method, hours) VALUES
        (1, '网络安全基础', 4, 1, 1, '必修', '理论', '考试', 64),
        (2, 'Java程序设计', 4, 1, 1, '必修', '理论', '考试', 64),
        (3, '高等数学', 6, 1, 1, '必修', '理论', '考试', 96),
        (4, '基础会计', 3, 4, 2, '必修', '理论', '考试', 48);

        INSERT INTO studentms.teacher (id, teacher_no, tname, password, role, department_id) VALUES
        (1, 'admin', '系统管理员', '123', 'admin', 1),
        (2, 'teacher', '张老师', '123', 'teacher', 1),
        (3, 'dean', '王院长', '123', 'dean', 1),
        (4, 'T004', '李老师', '123', 'teacher', 2);

        INSERT INTO studentms.student (id, student_no, sname, password, class_id, grade_level, major_id, department_id) VALUES
        (1, 'student', '学生本人', '123', 1, '2024级', 1, 1),
        (2, 'S24001', '赵小明', '123', 1, '2024级', 1, 1),
        (3, 'S24002', '钱小红', '123', 1, '2024级', 1, 1);

        INSERT INTO studentms.score (
          student_id, course_id, teacher_id, term, 
          usual_score, mid_score, final_score, grade
        ) VALUES 
        (1, 1, 2, '2024-2025-1', 85, NULL, 90, 88.5),
        (2, 1, 2, '2024-2025-1', 78, NULL, 82, 80.8),
        (3, 1, 2, '2024-2025-1', 92, NULL, 88, 89.2),
        (1, 2, 2, '2024-2025-1', 90, NULL, 85, 86.5);

        INSERT INTO studentms.course_open (course_id, teacher_id, term) VALUES
        (1, 2, '2024-2025-1'), (2, 2, '2024-2025-1'), (3, 2, '2024-2025-1'), (4, 4, '2024-2025-1');
        
        SET FOREIGN_KEY_CHECKS = 1;
    </update>

</mapper>
